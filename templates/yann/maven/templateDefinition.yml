resources:

  - name: {{ .Values.GitRepoMvn.name | default "src_code_backapp_mvn" }}
    type: GitRepo
    configuration:
      gitProvider: {{ .Values.GitRepoMvn.gitProvider }}
      path: {{ .Values.GitRepoMvn.path }}
      branches:
        include: {{ .Values.GitRepoMvn.branches.include }}
      files:
        include: {{ .Values.GitRepoMvn.files.include }}
        exclude: {{ .Values.GitRepoMvn.files.exclude }}

  - name: {{ .Values.BuildInfoMvn.resourceName | default "bi_backapp_mvn" }}
    type: BuildInfo
    configuration:
      sourceArtifactory: {{ .Values.ArtifactoryIntegration }}
      buildName: {{ .Values.BuildInfoMvn.name | default "BuildInfoMvn" }}
      buildNumber: ${run_number}

  - name: {{ .Values.BuildInfoMvn.resourceName | default "bi_backapp_mvn_promoted_staging" }} 
    type: BuildInfo
    configuration:
      sourceArtifactory: {{ .Values.ArtifactoryIntegration }}
      buildName: {{ .Values.BuildInfoMvn.name | default "BuildInfoMvn" }}
      buildNumber: '${run_number}'

  - name: {{ .Values.PropertyBagMvn | default "pb_backapp_mvn" }}  
    type: PropertyBag
    configuration:

  - name: {{ .Values.GitRepoContainer.name | default "src_dockerfile_backapp_mvn" }}
    type: GitRepo
    configuration:
      gitProvider: {{ .Values.GitRepoContainer.gitProvider }}
      path: {{ .Values.GitRepoContainer.path }}
      branches:
        include: {{ .Values.GitRepoContainer.branches.include }}
      files:
        include: {{ .Values.GitRepoContainer.files.include }}      

  - name: {{ .Values.BuildInfoContainer.resourceName | default "bi_backapp_mvn_docker" }}
    type: BuildInfo
    configuration:
      sourceArtifactory: {{ .Values.ArtifactoryIntegration }}
      buildName: {{ .Values.BuildInfoContainer.name | default "backapp_mvn_docker" }}
      buildNumber: '${run_number}'

  - name: bi_backapp_mvn_docker_promoted_staging
    type: BuildInfo
    configuration:
      sourceArtifactory: {{ .Values.ArtifactoryIntegration }}
      buildName: {{ .Values.BuildInfoContainer.name | default "backapp_mvn_docker" }}
      buildNumber: '${run_number}'

  - name: {{ .Values.FileSpecMvn.name | default "fs_backapp_mvn" }} 
    type: FileSpec
    configuration:
      sourceArtifactory: {{ .Values.ArtifactoryIntegration }}
      pattern: "{{ .Values.MvnPromoteRepo }}/**/multi-module-application-${runVarAppVersion}.jar"
      flat: {{ .Values.FileSpecMvn.flat | default true }}

  - name: {{ .Values.PropertyBagMvn | default "pb_backapp_mvn_docker" }}  
    type: PropertyBag
    configuration:   
      - name: scan_backapp_mvn
        type: XrayScan
        configuration:
          failOnScan: false
          inputResources:
            - name: {{ .Values.BuildInfoMvn.resourceName }}  
              trigger: true
            
      # - name: promote_bi_backapp_mvn
      #   type: PromoteBuild
      #   configuration:
      #     targetRepository: ${envVarMvnPromoteRepo}
      #     includeDependencies: false
      #     status: SANDBOX_OK
      #     comment: Unit testing and Xray scan passed succesfully
      #     copy: false
      #     inputResources:
      #       - name: bi_backapp_mvn
      #         trigger: true
      #     inputSteps:
      #       - name: scan_backapp_mvn
      #     outputResources:
      #       - name: pb_backapp_mvn            
      #       - name: bi_backapp_mvn_promoted_staging
      #   execution:  
      #     onStart:
      #       - echo ${res_bi_backapp_mvn_buildName} 
      #       - echo ${res_bi_backapp_mvn_buildNumber} 
      #     onSuccess:
      #       - write_output pb_backapp_mvn appVersion=${runVarAppVersion}
      #       - write_output pb_backapp_mvn appCommitSHA=${runVarGitCommit}
      #       - write_output pb_backapp_mvn biNumber=${res_bi_backapp_mvn_buildNumber}